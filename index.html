<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>å†¬å­£æˆ€æ­Œ Winter Campaign 2026</title>
    
    <!-- PWA & Mobile Meta -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#050a14">
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&family=Noto+Sans+TC:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        :root {
            --diamond: #00d2be;
            --bg-deep: #050a14;
            --card-glass: rgba(255, 255, 255, 0.08);
            --text-label: #f8fafc;
        }

        html, body {
            background-color: var(--bg-deep);
            color: #fff;
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            margin: 0; padding: 0;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
        }

        body {
            background-image: radial-gradient(circle at top, #1e293b 0%, #050a14 100%);
            min-height: 100vh;
        }

        .glass-card {
            background: var(--card-glass);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 24px;
        }

        .main-title {
            font-size: 2.8rem;
            font-weight: 900;
            line-height: 1.2;
            background: linear-gradient(to bottom, #ffffff, var(--diamond));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* ç¦®ç‰©ç¶²æ ¼ 4x2 */
        .gift-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            max-width: 300px;
            margin: 1.5rem auto;
        }
        .gift-item {
            aspect-ratio: 1;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 4px;
            display: flex;
            align-items: center; justify-content: center;
        }
        .gift-item img { width: 100%; height: 100%; object-fit: contain; }

        .cta-btn {
            background: linear-gradient(135deg, var(--diamond) 0%, #00a090 100%);
            box-shadow: 0 8px 20px rgba(0, 210, 190, 0.3);
            font-weight: 900;
            width: 180px;
            margin: 1.5rem auto 0;
            display: block;
        }

        .label-text {
            color: var(--text-label);
            font-size: 1rem;
            font-weight: 900;
            text-shadow: 0 1px 3px rgba(0,0,0,0.8);
            opacity: 0.9;
        }

        .diamond-text { color: var(--diamond); }

        /* æ’è¡Œæ¦œè¡¨æ ¼å„ªåŒ– */
        .rank-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }
        .rank-table th {
            @apply font-black text-xs py-4 uppercase tracking-widest;
            color: rgba(255,255,255,0.5);
            background: rgba(255,255,255,0.03);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .rank-table td {
            @apply py-4 border-b border-white/5;
        }
        .rank-table tr:nth-child(even) { background: rgba(255,255,255,0.02); }

        /* æ’åæ¬„ä½ç½®ä¸­å®¹å™¨ */
        .rank-cell-content {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            margin: 0 auto;
            font-size: 1.25rem;
            font-weight: 900;
        }

        .lang-btn {
            @apply px-3 py-1.5 rounded-xl border border-white/10 text-xs font-bold transition-all;
            background: rgba(0, 0, 0, 0.6);
        }
        .lang-btn.active { @apply bg-white text-black; }
    </style>
</head>
<body class="antialiased select-none pb-24">

    <!-- èªè¨€åˆ‡æ› -->
    <nav class="flex justify-center gap-2 pt-6 mb-6">
        <button onclick="changeLang('tw')" id="btn-tw" class="lang-btn active">ç¹</button>
        <button onclick="changeLang('cn')" id="btn-cn" class="lang-btn">ç®€</button>
        <button onclick="changeLang('en')" id="btn-en" class="lang-btn">EN</button>
        <button onclick="changeLang('jp')" id="btn-jp" class="lang-btn">JP</button>
    </nav>

    <div id="app" class="max-w-screen-sm mx-auto px-5 relative z-10">
        
        <!-- æ¨™é¡Œ -->
        <div class="text-center mb-6">
            <h1 id="t-title" class="main-title mb-1">å†¬å­£æˆ€æ­Œ</h1>
            <div id="t-date" class="text-base font-bold text-white/60">
                01.16 00:00 - 01.20 23:59 (GMT+8)
            </div>
        </div>

        <!-- æ´»å‹•æ‘˜è¦ -->
        <section class="glass-card p-6 text-center mb-8">
            <p id="t-summary-l1" class="text-lg font-bold leading-tight">
                é€ç›´æ’­é–“æˆ–èŠå¤©å®¤ä»»ä¸€é‘½çŸ³<br>ã€Œå†¬å­£æˆ€æ­Œã€ç³»åˆ—ç¦®ç‰©
            </p>
            
            <div class="gift-grid">
                <div class="gift-item"><img src="https://public.swag.live/products/livestream-cozy-scarf.png"></div>
                <div class="gift-item"><img src="https://public.swag.live/products/livestream-snowfall.png"></div>
                <div class="gift-item"><img src="https://public.swag.live/products/livestream-radiant-fireworks.png"></div>
                <div class="gift-item"><img src="https://public.swag.live/products/livestream-dazzling-earrings.png"></div>
                <div class="gift-item"><img src="https://public.swag.live/products/livestream-diamond-roses.png"></div>
                <div class="gift-item"><img src="https://public.swag.live/products/livestream-chasing-auroras.png"></div>
                <div class="gift-item"><img src="https://public.swag.live/products/livestream-midnight-toast.png"></div>
                <div class="gift-item"><img src="https://public.swag.live/products/livestream-ringing-in-2026.png"></div>
            </div>

            <p id="t-summary-l3" class="text-lg font-bold leading-snug">
                æ‡‰æ´æœ€æ„›ä¸»æ’­<br>
                <span class="text-2xl font-black diamond-text">å‰ååç¸½è¨ˆç²å¾— 55 è¬é‘½çŸ³</span>
            </p>

            <a href="https://creators.swag.live/win1" id="t-cta" class="cta-btn py-3.5 rounded-2xl text-lg uppercase tracking-widest">
                ä¸»æ’­æ´»å‹•è©³æƒ…
            </a>
        </section>

        <!-- å€‹äººæ•¸æ“šæ ¼ (éå°ç¨±å¯¬åº¦å„ªåŒ–) -->
        <section class="grid grid-cols-[2fr_3fr] gap-3 mb-8">
            <div class="glass-card p-4 flex flex-col items-center justify-center border-b-4 border-white/20">
                <div id="t-my-rank-label" class="label-text mb-1 text-white/50">å€‹äººæ’è¡Œ</div>
                <div id="user-rank" class="text-2xl font-black">--</div>
            </div>
            <div class="glass-card p-4 flex flex-col items-center justify-center border-b-4 border-diamond">
                <div id="t-my-cost-label" class="label-text mb-1 text-white/50">å€‹äººé€é‘½</div>
                <!-- é˜²æ­¢å¤§é¡æ•¸å­—æ–·è¡Œï¼Œå¾®èª¿å­—é«”å¤§å° -->
                <div id="user-cost" class="text-2xl font-black diamond-text whitespace-nowrap overflow-hidden">0</div>
            </div>
        </section>

        <!-- æ’è¡Œæ¦œ (ç²¾ç·»è¡¨æ ¼) -->
        <section class="glass-card mb-10 overflow-hidden">
            <div class="px-6 py-4 bg-white/5">
                <h2 id="t-lb-title" class="text-xl font-black">ç¦®ç‰©ç¸½é‘½æ’è¡Œæ¦œ</h2>
            </div>
            <table class="rank-table">
                <thead>
                    <tr>
                        <th class="w-20 text-center">æ’å</th>
                        <th class="text-left">é€ç¦®ç¸½é‘½çŸ³</th>
                        <th class="pr-6 text-right">çå‹µé‘½çŸ³</th>
                    </tr>
                </thead>
                <tbody id="leaderboard-body">
                    <!-- API Data Render -->
                </tbody>
            </table>
        </section>

        <!-- è©³ç´°èªªæ˜ -->
        <section class="px-2">
            <h3 id="t-rules-label" class="text-xl font-black mb-5 diamond-text">æ´»å‹•èªªæ˜</h3>
            <ul id="t-rules-list" class="space-y-4 text-white/80 text-lg leading-relaxed">
                <!-- Rules JS -->
            </ul>
        </section>
    </div>

    <script>
        const API_BASE = "https://campaign-2026-jan-905468082258.asia-east1.run.app";
        const REWARDS = [100000, 90000, 80000, 70000, 60000, 50000, 40000, 30000, 20000, 10000];

        const TRANSLATIONS = {
            tw: {
                title: "å†¬å­£æˆ€æ­Œ", date: "01.16 00:00 - 01.20 23:59 (GMT+8)",
                l1: "é€ç›´æ’­é–“æˆ–èŠå¤©å®¤ä»»ä¸€é‘½çŸ³<br>ã€Œå†¬å­£æˆ€æ­Œã€ç³»åˆ—ç¦®ç‰©",
                l3: "æ‡‰æ´æœ€æ„›ä¸»æ’­<br><span style='font-size:1.5rem;font-weight:900'>å‰ååç¸½è¨ˆç²å¾— 55 è¬é‘½çŸ³</span>",
                cta: "ä¸»æ’­æ´»å‹•è©³æƒ…", my_rank: "å€‹äººæ’è¡Œ", my_cost: "å€‹äººé€é‘½", lb_title: "ç¦®ç‰©ç¸½é‘½æ’è¡Œæ¦œ",
                th_rank: "æ’å", th_cost: "é€ç¦®ç¸½é‘½çŸ³", th_reward: "çå‹µé‘½çŸ³", rules_label: "æ´»å‹•èªªæ˜",
                rules: ["åƒ…é™é€ã€Œå†¬å­£æˆ€æ­Œã€ç³»åˆ—ç¦®ç‰©ï¼ŒåŒ…å«ç›´æ’­é–“èˆ‡èŠå¤©å®¤ã€‚", "è³‡æ–™è‡³å°‘éœ€ 5 åˆ†é˜æ›´æ–°æ™‚é–“ã€‚", "æ’åé‘½çŸ³å°‡æ–¼æ´»å‹•çµæŸå¾Œ 5 å€‹å·¥ä½œæ—¥å…§ç™¼æ”¾ã€‚", "æœ€çµ‚çµæœä»¥å®˜æ–¹è¨ˆç®—ç‚ºæº–ã€‚"],
                not_in_rank: "æœªå…¥æ¦œ"
            },
            cn: {
                title: "å†¬å­£æ‹æ­Œ", date: "01.16 00:00 - 01.20 23:59 (GMT+8)",
                l1: "é€ç›´æ’­é—´æˆ–èŠå¤©å®¤ä»»ä¸€é’»çŸ³<br>ã€Œå†¬å­£æ‹æ­Œã€ç³»åˆ—ç¤¼ç‰©",
                l3: "åº”æ´æœ€çˆ±ä¸»æ’­<br><span style='font-size:1.5rem;font-weight:900'>å‰ååæ€»è®¡è·å¾— 55 ä¸‡é’»çŸ³</span>",
                cta: "ä¸»æ’­æ´»åŠ¨è¯¦æƒ…", my_rank: "ä¸ªäººæ’è¡Œ", my_cost: "ä¸ªäººé€é’»", lb_title: "ç¤¼ç‰©æ€»é’»æ’è¡Œæ¦œ",
                th_rank: "æ’å", th_cost: "é€ç¤¼æ€»é’»çŸ³", th_reward: "å¥–åŠ±é’»çŸ³", rules_label: "æ´»åŠ¨è¯´æ˜",
                rules: ["ä»…é™é€ã€Œå†¬å­£æ‹æ­Œã€ç³»åˆ—ç¤¼ç‰©ï¼ŒåŒ…å«ç›´æ’­é—´ä¸èŠå¤©å®¤ã€‚", "æ•°æ®è‡³å°‘éœ€ 5 åˆ†é˜æ›´æ–°æ—¶é—´ã€‚", "æ’åé’»çŸ³å°†äºæ´»åŠ¨ç»“æŸå 5 å€‹å·¥ä½œæ—¥å†…å‘æ”¾ã€‚", "æœ€ç»ˆç»“æœä»¥å®˜æ–¹è®¡ç®—ç‚ºæº–ã€‚"],
                not_in_rank: "æœªå…¥æ¦œ"
            },
            en: {
                title: "Winter Melody", date: "Jan 16 00:00 - Jan 20 23:59 (GMT+8)",
                l1: "Send any 'Winter Melody' gifts<br>in live or chat rooms.",
                l3: "Support your favorites,<br><span style='font-size:1.5rem;font-weight:900'>Top 10 share 550,000 Diamonds</span>",
                cta: "Campaign Info", my_rank: "My Rank", my_cost: "My Gifting", lb_title: "Leaderboard",
                th_rank: "Rank", th_cost: "Diamonds", th_reward: "Rewards", rules_label: "Campaign Info",
                rules: ["Only 'Winter Melody' gifts count.", "Data updates every 5 minutes.", "Rewards distributed within 5 business days.", "Final count based on official records."],
                not_in_rank: "N/A"
            },
            jp: {
                title: "å†¬ã®æ‹æ­Œ", date: "01.16 00:00 - 01.20 23:59 (GMT+8)",
                l1: "ãƒ©ã‚¤ãƒ–ã‚„ãƒãƒ£ãƒƒãƒˆãƒ«ãƒ¼ãƒ ã§<br>ã€Œå†¬ã®æ‹æ­Œã€ã‚®ãƒ•ãƒˆã‚’è´ˆã‚ã†",
                l3: "ãƒ©ã‚¤ãƒãƒ¼ã‚’å¿œæ´ã—ã¦<br><span style='font-size:1.5rem;font-weight:900'>ä¸Šä½10åã«åˆè¨ˆ 55ä¸‡ãƒ€ã‚¤ãƒ¤è´ˆå‘ˆ</span>",
                cta: "è©³ç´°ã¯ã“ã¡ã‚‰", my_rank: "è‡ªåˆ†ã®é †ä½", my_cost: "åˆè¨ˆã‚®ãƒ•ãƒˆ", lb_title: "ãƒ©ãƒ³ã‚­ãƒ³ã‚°",
                th_rank: "é †ä½", th_cost: "ãƒ€ã‚¤ãƒ¤åˆè¨ˆ", th_reward: "å ±é…¬", rules_label: "è©³ç´°äº‹é …",
                rules: ["ã€Œå†¬ã®æ‹æ­Œã€ã‚·ãƒªãƒ¼ã‚ºãŒå¯¾è±¡ã§ã™ã€‚", "ãƒ‡ãƒ¼ã‚¿ã¯ç´„5åˆ†ã”ã¨ã«æ›´æ–°ã•ã‚Œã¾ã™ã€‚", "å ±é…¬ã¯çµ‚äº†å¾Œ5å–¶æ¥­æ—¥ä»¥å†…ã«é…å¸ƒã•ã‚Œã¾ã™ã€‚", "æœ€çµ‚çµæœã¯å…¬å¼è¨˜éŒ²ã«åŸºã¥ãã¾ã™ã€‚"],
                not_in_rank: "åœå¤–"
            }
        };

        let currentLang = 'tw';

        function getUserId() {
            const urlParams = new URLSearchParams(window.location.search);
            const hashParams = new URLSearchParams(window.location.hash.replace('#', '?'));
            let uid = urlParams.get('user_id') || hashParams.get('user_id');
            if (!uid) {
                const match = window.location.href.match(/[a-f0-9]{24}/i);
                if (match) uid = match[0];
            }
            return uid;
        }

        async function updateUI() {
            const lang = TRANSLATIONS[currentLang];
            const uid = getUserId();
            
            document.getElementById('t-title').innerText = lang.title;
            document.getElementById('t-date').innerText = lang.date;
            document.getElementById('t-summary-l1').innerHTML = lang.l1;
            document.getElementById('t-summary-l3').innerHTML = lang.l3;
            document.getElementById('t-cta').innerText = lang.cta;
            document.getElementById('t-my-rank-label').innerText = lang.my_rank;
            document.getElementById('t-my-cost-label').innerText = lang.my_cost;
            document.getElementById('t-lb-title').innerText = lang.lb_title;
            document.getElementById('t-rules-label').innerText = lang.rules_label;
            
            const ths = document.querySelectorAll('th');
            ths[0].innerText = lang.th_rank; ths[1].innerText = lang.th_cost; ths[2].innerText = lang.th_reward;

            const rulesUl = document.getElementById('t-rules-list');
            rulesUl.innerHTML = lang.rules.map(r => `<li>â€¢ ${r}</li>`).join('');

            try {
                const apiPath = uid ? `${API_BASE}/?user_id=${uid}` : API_BASE;
                const res = await fetch(apiPath, { credentials: 'omit' });
                const data = await res.json();
                renderUser(data.user_info, lang);
                renderLeaderboard(data.leaderboard_top10 || []);
            } catch (err) { 
                console.error(err); 
                renderUser(null, lang);
            }
        }

        function renderUser(info, lang) {
            const rEl = document.getElementById('user-rank');
            const cEl = document.getElementById('user-cost');
            if (info && info !== "User not found" && typeof info === 'object') {
                rEl.innerText = info.rank; // ç§»é™¤ #
                cEl.innerText = (info.diamond_cost || 0).toLocaleString();
            } else {
                rEl.innerText = lang.not_in_rank;
                cEl.innerText = "0";
            }
        }

        function renderLeaderboard(list) {
            const body = document.getElementById('leaderboard-body');
            body.innerHTML = "";
            const medals = ["ğŸ¥‡", "ğŸ¥ˆ", "ğŸ¥‰"];
            
            for (let i = 0; i < 10; i++) {
                const item = list[i];
                if (!item && list.length > 0 && i >= list.length) continue;

                const rankVal = (i + 1);
                const costVal = item ? (item.diamond_cost || 0).toLocaleString() : "0";
                const rewardVal = REWARDS[i] ? REWARDS[i].toLocaleString() : "0";
                const rankDisplay = medals[i] || rankVal;

                body.innerHTML += `
                    <tr>
                        <td class="text-center">
                            <div class="rank-cell-content">${rankDisplay}</div>
                        </td>
                        <td class="text-white font-bold text-lg">${costVal}</td>
                        <td class="pr-6 text-right font-black text-lg diamond-text">${rewardVal}</td>
                    </tr>
                `;
            }
        }

        function changeLang(l) {
            currentLang = l;
            document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`btn-${l}`).classList.add('active');
            updateUI();
        }

        window.onload = updateUI;
    </script>
</body>
</html>
